<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>我的坚果云文档浏览</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; padding: 20px; }
    h2 { margin-bottom: 10px; }
    ul { list-style: none; padding-left: 20px; }
    li { margin: 6px 0; }
    a { text-decoration: none; color: #007bff; }
    a:hover { text-decoration: underline; }
    .breadcrumb { margin-bottom: 16px; font-size: 14px; color: #555; }
  </style>
</head>
<body>
  <h2>📁 我的坚果云</h2>
  <div class="breadcrumb" id="breadcrumb">首页</div>
  <ul id="fileList"></ul>

  <script>
    // ✅ “我的坚果云” 与 index.html 同级
    const rootFolder = '我的坚果云/';
    const fileListEl = document.getElementById('fileList');
    const breadcrumbEl = document.getElementById('breadcrumb');

    async function loadFolder(path, displayName = '首页') {
      const response = await fetch(path);
      const html = await response.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const links = [...doc.querySelectorAll('a')];
      const items = links.map(a => a.getAttribute('href')).filter(h => h && h !== '../');

      const folders = [];
      const files = [];

      for (const item of items) {
        if (item.endsWith('/')) folders.push(item);
        else files.push(item);
      }

      // 面包屑导航
      const relative = path.replace(rootFolder, '');
      const parts = relative.split('/').filter(Boolean);
      breadcrumbEl.innerHTML =
        parts.length === 0
          ? '首页'
          : `<a href="#" onclick="loadFolder('${rootFolder}')">首页</a> / ` +
            parts
              .map((p, i) => {
                const subPath = rootFolder + parts.slice(0, i + 1).join('/') + '/';
                return `<a href="#" onclick="loadFolder('${subPath}')">${p}</a>`;
              })
              .join(' / ');

      fileListEl.innerHTML = '';

      if (folders.length > 0) {
        // ✅ 仅显示文件夹
        folders.forEach(folder => {
          const li = document.createElement('li');
          const name = folder.replace(/\/$/, '');
          li.innerHTML = `📂 <a href="#" onclick="loadFolder('${path + folder}', '${name}')">${name}</a>`;
          fileListEl.appendChild(li);
        });
      } else if (files.length > 0) {
        // ✅ 一旦检测到文件，按“--”逻辑分组显示
        const grouped = {};
        files.forEach(file => {
          const name = decodeURIComponent(file);
          const parts = name.split('--');
          let current = grouped;
          for (let i = 0; i < parts.length; i++) {
            const part = parts[i].replace(/\.md$/, '');
            if (!current[part]) current[part] = i === parts.length - 1 ? null : {};
            current = current[part] || {};
          }
        });

        function renderTree(node, container) {
          for (const key in node) {
            const li = document.createElement('li');
            if (node[key] === null) {
              li.textContent = key; // 文件
            } else {
              li.innerHTML = `<strong>${key}</strong>`;
              const ul = document.createElement('ul');
              renderTree(node[key], ul);
              li.appendChild(ul);
            }
            container.appendChild(li);
          }
        }

        renderTree(grouped, fileListEl);
      } else {
        fileListEl.innerHTML = '<li>（空文件夹）</li>';
      }
    }

    // ✅ 初始化首页：显示“我的坚果云”下的文件夹
    loadFolder(rootFolder);
  </script>
</body>
</html>

