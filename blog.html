---
layout: default
title: 文档中心
---

<style>
body {margin:0;font-family:Arial,Helvetica,sans-serif;display:flex;height:100vh;}
main {flex:1;display:flex;overflow:hidden;}
.left-panel {width:260px;background:#f3f4f6;overflow:auto;padding:10px;border-right:1px solid #ddd;}
.right-panel {flex:1;padding:10px;overflow:auto;}
ul {list-style:none;padding-left:0;margin:0;}
li {margin:4px 0;}
a {cursor:pointer;text-decoration:none;color:#111;}
a:hover {text-decoration:underline;}
.article-card {display:none;}
.article-card.active {display:block;}
.back-btn {margin-bottom:10px;padding:4px 8px;background:#3b82f6;color:#fff;border:none;border-radius:4px;cursor:pointer;display:none;}
</style>

<main>
  <div class="left-panel">
    <button class="back-btn" id="backBtn" onclick="goBack()">← 返回</button>
    <h3 id="currentFolderName"></h3>
    <ul id="listContainer"></ul>
  </div>
  <div class="right-panel" id="contentPanel">
    {% assign files = site.pages | where_exp:"p","p.path contains '我的坚果云/'" | sort:"path" %}
    {% for file in files %}
      <div class="article-card" id="{{ file.url | replace:'/','_' | replace:'.md','' }}">
        {{ file.content | markdownify }}
      </div>
    {% endfor %}
  </div>
</main>

<script>
const files = [
  {% for file in files %}
    {
      path: "{{ file.path }}",
      name: "{{ file.path | split:'/' | last | replace:'.md','' }}",
      url: "{{ file.url | replace:'/','_' | replace:'.md','' }}"
    },
  {% endfor %}
];

const folderTree = {}; // 保存所有文件夹和文件
files.forEach(f => {
  const parts = f.path.split('/');
  const topFolder = parts[2]; // 我的坚果云下的一级文件夹
  if (!folderTree[topFolder]) folderTree[topFolder] = { _folders: {}, _files: [] };
  const subPath = parts.slice(3).join('/');
  if(subPath) {
    folderTree[topFolder]._files.push({ name: f.name, url: f.url });
  }
});

// 栈记录当前路径，用于返回
let pathStack = [];

// 首页显示一级文件夹
function showFolders() {
  pathStack = [];
  document.getElementById('backBtn').style.display = 'none';
  document.getElementById('currentFolderName').textContent = '我的坚果云';
  const container = document.getElementById('listContainer');
  container.innerHTML = '';
  Object.keys(folderTree).forEach(f => {
    const li = document.createElement('li');
    const a = document.createElement('a');
    const count = folderTree[f]._files.length;
    a.textContent = `${f} (${count})`;
    a.onclick = () => showFiles(folderTree[f], f);
    li.appendChild(a);
    container.appendChild(li);
  });
}

// 显示文件夹下文件（按 -- 分割）
function showFiles(node, name) {
  pathStack.push({node, name});
  document.getElementById('backBtn').style.display = 'inline-block';
  document.getElementById('currentFolderName').textContent = name;
  const container = document.getElementById('listContainer');
  container.innerHTML = '';

  // 按 -- 构建树
  const tree = buildTree(node._files);
  renderTree(tree, container);
}

// 按 -- 构建文件树
function buildTree(files) {
  const root = { _files: [], children: {} };
  files.forEach(f => {
    const parts = f.name.split('--');
    let current = root;
    for (let i = 0; i < parts.length - 1; i++) {
      const part = parts[i];
      if (!current.children[part]) current.children[part] = { _files: [], children: {} };
      current = current.children[part];
    }
    current._files.push({ name: parts[parts.length - 1], url: f.url });
  });
  return root;
}

// 渲染树结构
function renderTree(node, container) {
  Object.keys(node.children).forEach(key => {
    const li = document.createElement('li');
    li.textContent = key;
    const ul = document.createElement('ul');
    renderTree(node.children[key], ul);
    li.appendChild(ul);
    container.appendChild(li);
  });
  node._files.forEach(f => {
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.textContent = f.name;
    a.onclick = () => showArticle(f.url);
    li.appendChild(a);
    container.appendChild(li);
  });
}

// 显示文章内容
function showArticle(id) {
  document.querySelectorAll('.article-card').forEach(c => c.classList.remove('active'));
  const article = document.getElementById(id);
  if(article) article.classList.add('active');
  window.scrollTo(0,0);
}

// 返回上一层或首页
function goBack() {
  pathStack.pop();
  if(pathStack.length === 0) {
    showFolders();
  } else {
    const last = pathStack[pathStack.length-1];
    showFiles(last.node, last.name);
  }
}

window.onload = showFolders;
</script>

