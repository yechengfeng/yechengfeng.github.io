- #### 1 业务分析

  - 优惠券管理和发放

    > - 优惠券类型：每满减 : 满减 ：无门槛 ：折扣
    > - 优惠券发放：(立刻发放:定时发放) 领取期限，使用限制方式（固定天数，多少天之内可以用，固定时间段）
    >
    > 

  - 优惠券的领取和使用
    - 手动领取
    - 兑换码兑换

- ##### 2数据库设计

  - 优惠券表（coupon）

    <img src="https://leslieyedoc.oss-cn-shanghai.aliyuncs.com/img/20250922-202316-image-20250922202312523.png" alt="image-20250922202312523" style="zoom:100%; float:left" />

  - 优惠券使用范围表（coupon_scope优惠券使用范围）

    <img src="https://leslieyedoc.oss-cn-shanghai.aliyuncs.com/img/20250922-202813-image-20250922202806725.png" alt="image-20250922202806725" style="zoom:100%;float:left" />

  - 兑换码表(exchange code)

    <img src="https://leslieyedoc.oss-cn-shanghai.aliyuncs.com/img/20250922-202930-image-20250922202927960.png" alt="image-20250922202927960" style="zoom:100%;float:left" />

  - 用户券表 (user_coupon) 用户券表 

    <img src="https://leslieyedoc.oss-cn-shanghai.aliyuncs.com/img/20250922-203819-image-20250922203814651.png" alt="image-20250922203814651" style="zoom:50%;float:left" />

- ##### 3技术栈

  > Springboot,   SpringCLoud ,  mybatisPlus,   redis,  RabbitMQ, XXL-Job, CompletableFuture + countDownLatch

- ##### 兑换码表

  > 1. 可读性好
  >
  >    - 长度不超过10个字符
  >    - 只能是24个大写字母和8个数字，去掉 I和1,0和o
  >
  > 2. 兑换码算法
  >
  >    - UUID 不唯一 太长
  >    - 雪花算法 太长
  >    - 自增ID  容易被猜到
  >
  > 3. base32算法
  >
  > 4. 生成
  >
  >    - 利用redis自增来生成序列号S,作为兑换码的唯一标识
  >    - 优惠券id的后四位作为新鲜值f,从秘钥列表得到秘钥:key
  >    - 将S拼接f得到载荷payload,利用秘钥加密(playload每四位乘加权数)，求和取后十四位得到签名C
  >    - 将c,f,s拼接，利用base32编码，得到最终一个兑换码
  >
  > 5. 兑换码校验
  >
  >    > 1. 从要校验的兑换码中分别获取 f,c,s
  >    > 2. 再次利用生成算法，得到签名c2
  >    > 3. 将c2和c1比较，一致则认为是有效兑换码
  >
  > 6. 总结
  >
  >     - 明文组成
  >       - 十四位签名+4位新鲜值+32位序列号
  >     - 兑换码生成
  >       - 利用redis自增来生成序列号s,作为兑换码的唯一标识
  >       - 利用优惠券id的后四位做新鲜值f,从秘钥列表得到秘钥:key
  >       - 将s拼接f得到载荷payload,利用秘钥加密(payload每四位乘以加权数) 求和，取后十四位得到签名c
  >       - 将c ,f,s拼接 利用base32编码 得到最后的兑换码
  >     - 兑换码校验
  >       - 从要校验的兑换码中分别获取f,c,s
  >       - 再次利用生成算法，得到签名c2
  >       - 将c2和c1比较，一致则认为是有效兑换码

- 优惠券组合支付

  > 



