https://mp.weixin.qq.com/s?__biz=Mzk0MTYxNDgyNA==&mid=2247490689&idx=1&sn=e7bf5edf52e80aa849ecf8904f8b2c1a&scene=21&poc_token=HCP1wGijNVJ4vCVONBXlL83wVgGW6LvJgm65dUzJ

- **不同Topic的消息有序性**

​				需要引用协调者

- **相同的topic保证有序性**（Kafka **单个 partition 内消息是有序的**

  - **分区有序**

    - **同一业务实体（如同一订单ID）的消息**必须发到同一个 partition。

      ```java
        int partition =orderId.hashCode() % partitionCount
      ProducerRecord<String, String> record =
          new ProducerRecord<>("order-topic",partition , null, "msg"); 
      // 直接发送到指定分区
      producer.send(record);
      
      producer.send(new ProducerRecord<>(
          "order-topic", 
          orderId,   // 作为 partition key
          message
      ));
      
      ```

    - 消费时，**一个 partition 只能被一个 consumer 线程顺序消费**。

  - **全局有序**

    - 如果要**整个 topic 的全局顺序**（非常少见），那只能：
      - topic **只有一个 partition**，消费者单线程消费。
         	缺点：吞吐量大幅下降，不适合高并发。

