FTI项目背景

> 1. 我参与项目是银行内部的资金和风险模拟预测系统。核心目标是基于银行的资产负债表、头寸信息和市场利率数据，通过资金转移定价（FTP） 模型，来预测在未来不同市场压力情景（如利率骤升、市场流动性枯竭）下，银行的盈利能力和资本充足率会受到怎样的影响。我们的项目主要是采用微服务架构，分模块，模块之间调用是kafka消息和openfeign.
> 2. 我们的预测粒度是对于公司固定的部门，固定的账号，固定的业务方向，固定的货币，固定的支付对象(内部支付还是third_party还是其他的),这几个组成我们的业务主键，然后基于头寸信息，以及外部数据(比如利率这些)来根据一个模型来预测出来本金，收入，利息，负债风险这些情况。



一些银行概念

头寸

> 某一个时刻拥有的金融产品的一个持有情况

利率敞口和压力测试

> 当利率发生改变的时候，我的收支情况和支出情况可能发生改变

项目的负责点和技术难点

> 1. 数据源 : 数量巨大，光是头寸信息 我们的表中就存了60亿数据。一个批次的任务头寸信息有大约1000万条
> 2. 我们有多个环境，UAT3,UAT1,UAT7 ,sit,dev,环境。
> 3. 模型因子，我们通过策略模式去封装拿到数据。
> 4. 日志采用ELK
> 5. 关于利率计算，利率分为固定利率和浮动利率，比如一笔存款三月份到期，我要计算二月份情况，这笔钱如何算。

负责的点

> 主要负责担保基金(secured funding ).主要涉及到模型因为的计算这一块，因为模型因子本身是动态变化的，需要根据部门信息，去拿到一个层级关系，（MS,MG,LE）,取调用一个API，获取真实的模型因子。
>
> 主要我处理的优化点，比如基于异步获取元数据，异步计算，异步插入数据库，ParallelStream。FutureFask进行优化,20000多个模型因子，解析模型因子的时候，请求外部数据的时候，利用锁+ConcurrentMap, 如果已经存在 ，直接从本地缓存拿数据，否则通过API去拿。
>
> 
>
> 什么是转移定价

> 客户存入100万利率2.5%的存款，存款部门按照3.5%的价格卖给资金部，资金部按照百分之四的价格卖给贷款部门，贷款部门会以百分之5的价格放贷，这就是FTP的一个内部转移定价，具体表现在我们的系统上，就是业务主键。同时记账的时候现金流增加100万，负债增加100万。然后我们分别会在资产和负债的account都上一笔记录

缓存怎么用的

> 1. 幂等性设计: 我们主要通过分布式锁锁定一些数据信息。比如用户已经跑了一个批次数据，会传入一个Data_set_id,as_of,我们会把这个数据插入到缓存里面，如果用户下次跑这个任务是跑不通的。
> 2. 计算好的数据MO_KEY的值，会存入这个缓存里面，方面重复使用。
> 3. 消息队列



分布式事务问题

> 有遇到场景，但是通常是基于一种补偿机制来避免使用分布式锁。降低业务的复杂度，如果引入分布式事务，那么事务协调者，上集群。主要还是一种业务取舍

Reasonability Validation

> 权限校验，集成tibco，文件解析，数据迁移工作. 框架搭建。数据展示这块，用了策略模式+工厂模式.  来获取图表的数据

