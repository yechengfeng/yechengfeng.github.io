---
layout: default
title: 文档中心
---

<style>
body {margin:0;font-family:Arial,Helvetica,sans-serif;display:flex;height:100vh;}
nav {width:260px;background:#1f2937;color:#fff;position:fixed;top:0;left:0;height:100%;overflow:auto;}
nav .nav-header {padding:1em;text-align:center;font-weight:bold;font-size:1.2em;background:#111827;}
nav ul {list-style:none;padding-left:0;margin:0;}
nav li a {display:block;color:#e5e7eb;text-decoration:none;padding:0.4em 1em;}
nav li a:hover, nav li a.active {background:#3b82f6;color:#fff;border-radius:4px;}
details summary {cursor:pointer;padding:0.4em 1em;}
details[open]>summary {font-weight:bold;}
details summary::after {content:"▸";float:right;transition:transform 0.2s;}
details[open] summary::after {transform:rotate(90deg);}
main {margin-left:260px;padding:1em;flex:1;overflow:auto;}
.article-card {display:none;}
.article-card.active {display:block;}
#navToggle {display:none;}
#searchBox {width:calc(100% - 2em);margin:0.5em 1em;padding:0.4em;border-radius:4px;border:none;}
@media(max-width:768px){
  #navToggle {display:block;position:fixed;top:10px;left:10px;z-index:1000;}
  nav {left:-260px;transition:left 0.3s;}
  nav.open {left:0;}
  main {margin-left:0;}
}
</style>

<button id="navToggle">☰</button>

<nav>
  <div class="nav-header">Yechengfeng</div>
  <input type="text" id="searchBox" placeholder="搜索文件..." onkeyup="filterNav()">
  <div id="navListContainer">
    <ul id="navList"></ul>
  </div>
</nav>

<main id="mainContent">
  {% assign files = site.pages | where_exp:"p","p.path contains '我的坚果云/note/'" | sort:"path" %}
  {% for file in files %}
    <div class="article-card" id="{{ file.url | replace:'/','_' | replace:'.md','' }}">
      {{ file.content | markdownify }}
    </div>
  {% endfor %}
</main>

<script>
var files = [
  {% for file in files %}
    {
      name: "{{ file.path | split:'/' | last | replace:'.md','' }}",
      url: "{{ file.url | replace:'/','_' | replace:'.md','' }}"
    },
  {% endfor %}
];

// 构建多层目录树
function buildTree(files){
  let root = {_files:[]};
  files.forEach(f=>{
    let parts = f.name.split('--');
    if(parts.length === 1){
      root._files.push({name: parts[0], url:f.url});
    } else {
      let current = root;
      for(let i=0;i<parts.length-1;i++){
        let part = parts[i];
        if(!current[part]) current[part] = {children:{}, _files:[]};
        current = current[part].children;
      }
      let lastPart = parts[parts.length-1];
      if(!current._files) current._files=[];
      current._files.push({name:lastPart,url:f.url});
    }
  });
  return root;
}

// 渲染树
function renderTree(node, container){
  // 渲染当前层的文件
  if(node._files){
    node._files.forEach(f=>{
      let li=document.createElement('li');
      let a=document.createElement('a');
      a.href="#"; a.textContent=f.name;
      a.onclick=()=>{showArticle(f.url,a);return false;};
      li.appendChild(a);
      container.appendChild(li);
    });
  }
  Object.keys(node).forEach(key=>{
    if(key === "_files" || key === "children") return;
    let value = node[key];
    let li=document.createElement('li');
    let details=document.createElement('details');
    let summary=document.createElement('summary');
    summary.textContent=key;
    details.appendChild(summary);

    let ul=document.createElement('ul');
    renderTree(value.children, ul);
    // 渲染该目录下的文件
    if(value._files){
      value._files.forEach(f=>{
        let fileLi=document.createElement('li');
        let a=document.createElement('a');
        a.href="#"; a.textContent=f.name;
        a.onclick=()=>{showArticle(f.url,a);return false;};
        fileLi.appendChild(a);
        ul.appendChild(fileLi);
      });
    }
    details.appendChild(ul);
    li.appendChild(details);
    container.appendChild(li);
  });
}

function showArticle(id, linkElem){
  document.querySelectorAll('.article-card').forEach(c=>c.classList.remove('active'));
  let article=document.getElementById(id);
  if(article) article.classList.add('active');
  document.querySelectorAll("#navListContainer a").forEach(a=>a.classList.remove("active"));
  if(linkElem) linkElem.classList.add("active");
  localStorage.setItem('currentArticle', id);
  if(window.innerWidth<=768) document.querySelector('nav').classList.remove('open');
}

function filterNav(){
  let input=document.getElementById('searchBox').value.toLowerCase();
  document.querySelectorAll("#navListContainer li").forEach(item=>{
    item.style.display=item.textContent.toLowerCase().includes(input)?"":"none";
  });
}

document.getElementById('navToggle').addEventListener('click', ()=>{
  document.querySelector('nav').classList.toggle('open');
});

window.onload=function(){
  let tree=buildTree(files);
  renderTree(tree, document.getElementById('navList'));
  let id=localStorage.getItem('currentArticle');
  if(id && document.querySelector("#navListContainer a[onclick*='"+id+"']")){
    document.querySelector("#navListContainer a[onclick*='"+id+"']").click();
  } else {
    let firstLink=document.querySelector("#navListContainer a");
    if(firstLink) firstLink.click();
  }
}
</script>

